# Чек-лист задач для example-server

## Блок 1. Скелет проекта

- [x] [S-01] Инициализировать Go-модуль (go.mod, main.go) под Go 1.25.5.
- [x] [S-02] Описать структуру `ServerConfig` и чтение `server-config.yaml`.
- [x] [S-03] Добавить поддержку флага `-config` (кастомный путь к конфигу).

## Блок 2. Модели и хранилища

- [x] [S-04] Описать модели `User`, `AuthToken`.
- [x] [S-05] Описать DTO `ServerDTO`, `RouteProfileDTO` (по specs/data-models-specs.md).
- [x] [S-06] Описать внутренние структуры `Server`, `RouteProfile` (если отличаются от DTO).
- [x] [S-07] Реализовать in-memory хранилища: `users`, `tokens`, `servers`, `routes`.

## Блок 3. Загрузка данных из файлов

- [x] [S-08] Реализовать загрузку всех `*.json` из `servers_dir` в `[]ServerDTO`.
- [x] [S-09] Реализовать загрузку всех `*.json` из `routes_dir` в `[]RouteProfileDTO`.
- [x] [S-10] Добавить базовую валидацию DTO и фатальную ошибку при невалидных данных.

## Блок 4. HTTP-сервер

- [x] [S-11] Поднять HTTP-сервер, слушающий `listen_addr` из `ServerConfig`.
- [x] [S-12] Реализовать обработчик `GET /health` (200 + `"OK"`).

## Блок 5. Auth

- [x] [S-13] Реализовать обработчик `POST /auth` (парсинг JSON, проверка логин/пароль из конфига).
- [x] [S-14] Реализовать генерацию токена и хранение в `tokens` (map).
- [x] [S-15] Определить единственного пользователя по `user_login`/`user_password` из `ServerConfig`.

## Блок 6. Авторизационный слой

- [x] [S-16] Реализовать функцию проверки токена из заголовка `Authorization: Bearer <token>`.
- [x] [S-17] Подключить проверку токена к защищённым эндпоинтам.

## Блок 7. /sync/servers и /sync/routes

- [x] [S-18] Реализовать `GET /sync/servers` (проверка токена, возврат `ServerDTO[]`).
- [x] [S-19] Реализовать `GET /sync/routes` (проверка токена, возврат `RouteProfileDTO[]`).
- [x] [S-20] Определить и реализовать единый формат ответов 401/500.

## Блок 8. Логирование

- [x] [S-21] Реализовать простой логгер с уровнями `info`/`error` и таймштампом.
- [x] [S-22] Логировать старт сервера и загрузку конфига/данных.
- [x] [S-23] Логировать каждый запрос (метод, путь, код, время).
- [x] [S-24] Логировать ошибки авторизации и внутренние ошибки (401/500).

## Блок 9. Завершение и проверки

- [x] [S-25] (Опционально) Добавить graceful shutdown по Ctrl+C/SIGINT.
- [x] [S-26] Прогнать ручные проверки `/health`, `/auth`, `/sync/servers`, `/sync/routes` с корректными и некорректными сценариями.
